(function(e){function t(t){for(var o,a,r=t[0],c=t[1],l=t[2],d=0,f=[];d<r.length;d++)a=r[d],s[a]&&f.push(s[a][0]),s[a]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);u&&u(t);while(f.length)f.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,r=1;r<n.length;r++){var c=n[r];0!==s[c]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},s={app:0},i=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var l=0;l<r.length;l++)t(r[l]);var u=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1:function(e,t){},1581:function(e,t,n){"use strict";var o=n("7a0a"),s=n.n(o);s.a},"3bd3":function(e,t,n){"use strict";var o=n("7024"),s=n.n(o);s.a},"56d7":function(e,t,n){"use strict";n.r(t);var o={};n.r(o),n.d(o,"getRoom",function(){return v}),n.d(o,"getName",function(){return h}),n.d(o,"getState",function(){return _}),n.d(o,"getVideoClients",function(){return g}),n.d(o,"getScreenClients",function(){return b}),n.d(o,"getMessages",function(){return w}),n.d(o,"getConnIsReady",function(){return C});var s={};n.r(s),n.d(s,"setConnIsReady",function(){return y}),n.d(s,"setMeName",function(){return S}),n.d(s,"setShowChat",function(){return M}),n.d(s,"setMuted",function(){return k}),n.d(s,"setPaused",function(){return j}),n.d(s,"addPeer",function(){return x}),n.d(s,"removePeer",function(){return O}),n.d(s,"addMessage",function(){return F}),n.d(s,"setScreenSharing",function(){return z});n("cadf"),n("551c"),n("097d");var i=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},r=[],c={name:"app"},l=c,u=(n("5c0b"),n("2877")),d=Object(u["a"])(l,a,r,!1,null,null,null);d.options.__file="App.vue";var f=d.exports,p=n("2f62"),m={room:"",connIsReady:!1,state:{name:"",muted:!1,paused:!1,screenSharing:!1,showChat:!1},clients:[],messages:[]},v=(n("7f7f"),function(e){return e.room}),h=function(e){return e.state.name},_=function(e){return e.state},g=function(e){return e.clients.filter(function(e){return"video"===e.peer.type})},b=function(e){return e.clients.filter(function(e){return"screen"===e.peer.type})},w=function(e){return e.messages},C=function(e){return e.connIsReady},y=function(e,t){e.connIsReady=t},S=function(e,t){e.state.name=t},M=function(e,t){e.state.showChat=t},k=function(e,t){e.state.muted=t},j=function(e,t){e.state.paused=t},x=function(e,t){var n=t.video,o=t.peer;e.clients.push({video:n,peer:o})},O=function(e,t){e.clients=e.clients.filter(function(e){return e.peer.id!==t.id||e.peer.type!==t.type})},F=function(e,t){e.messages.push(t)},z=function(e,t){e.state.screenSharing=t};i["a"].use(p["a"]);var P=new p["a"].Store({state:m,mutations:s,getters:o}),R=n("8c4f"),$=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home-bg"},[n("div",{staticClass:"home"},[n("Icon"),n("div",{staticClass:"home__content"},[n("h1",[e._v("We Meeting")]),n("h2",[e._v("——基于WebRTC的多人实时会议系统")]),n("el-tabs",{staticStyle:{"margin-top":"20px"},attrs:{type:"border-card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"加入会议",name:"join"}},[n("form",{staticClass:"join",attrs:{action:"#"},on:{submit:function(t){return t.preventDefault(),e.join(t)}}},[n("label",{staticClass:"label",attrs:{for:"room"}},[e._v("房间号")]),n("el-input",{attrs:{type:"text",name:"room",id:"room",placeholder:"会议房间号","prefix-icon":"el-icon-service"},model:{value:e.room,callback:function(t){e.room="string"===typeof t?t.trim():t},expression:"room"}}),n("label",{staticClass:"label",attrs:{for:"name"}},[e._v("给自己取一个名字吧")]),n("el-input",{attrs:{type:"text",name:"name",id:"name",placeholder:"您在房间内的昵称","prefix-icon":"el-icon-user"},model:{value:e.name,callback:function(t){e.name="string"===typeof t?t.trim():t},expression:"name"}}),n("el-button",{staticClass:"button",attrs:{type:"primary"},on:{click:e.join}},[e._v("加入会议")])],1)]),n("el-tab-pane",{attrs:{label:"创建会议",name:"create"}},[n("form",{staticClass:"join",attrs:{action:"#"},on:{submit:function(t){return t.preventDefault(),e.join(t)}}},[n("label",{staticClass:"label",attrs:{for:"room"}},[e._v("房间号(随机生成)")]),n("el-input",{attrs:{type:"text",name:"room",id:"room","prefix-icon":"el-icon-service",disabled:""},model:{value:e.room,callback:function(t){e.room="string"===typeof t?t.trim():t},expression:"room"}}),n("label",{staticClass:"label",attrs:{for:"name"}},[e._v("给自己取一个名字吧")]),n("el-input",{attrs:{type:"text",name:"name",id:"name",placeholder:"您在房间内的昵称","prefix-icon":"el-icon-user"},model:{value:e.name,callback:function(t){e.name="string"===typeof t?t.trim():t},expression:"name"}}),n("el-button",{staticClass:"button",attrs:{type:"primary"},on:{click:e.join}},[e._v("创建会议")])],1)])],1)],1)],1)])},Z=[],V=n("be94"),I=n("c64e"),B=n.n(I),D=function(e,t){var n=t._c;return n("svg",{staticClass:"icon",attrs:{t:"1589531461379",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1269",width:"100",height:"100"}},[n("path",{attrs:{d:"M667.8 546.3a58.5 35.2 90 1 0 70.4 0 58.5 35.2 90 1 0-70.4 0Z",fill:"#5097FF","p-id":"1270"}}),n("path",{attrs:{d:"M702.1 624.9c-21.1 0-40.7-10.1-55.2-28.4-13.7-17.3-21.2-40-21.2-64.1 0-24.1 7.5-46.8 21.2-64.1C661.5 450 681 440 702.1 440s40.7 10.1 55.2 28.4c13.7 17.3 21.2 40 21.2 64.1 0 24.1-7.5 46.8-21.2 64.1-14.5 18.2-34.1 28.3-55.2 28.3z m0-154.9c-11.7 0-23 6-31.6 17-9.5 12-14.7 28.1-14.7 45.4s5.2 33.5 14.7 45.4c8.7 11 19.9 17 31.6 17s23-6 31.6-17c9.5-12 14.7-28.1 14.7-45.4 0-17.3-5.2-33.5-14.7-45.4-8.6-11-19.9-17-31.6-17z",fill:"#06275B","p-id":"1271"}}),n("path",{attrs:{d:"M818 786.9H636.8c-9.7 0-17.6-7.9-17.6-17.6 0-67.8 40.5-103.6 108.2-103.6 67.8 0 108.2 35.8 108.2 103.6 0 9.7-7.9 17.6-17.6 17.6z",fill:"#5097FF","p-id":"1272"}}),n("path",{attrs:{d:"M807.7 803.9H596.5c-18 0-32.6-14.6-32.6-32.6v-9.4c0-76.2 62-138.2 138.2-138.2s138.2 62 138.2 138.2v9.4c0 17.9-14.6 32.6-32.6 32.6zM702.1 653.6c-59.7 0-108.2 48.6-108.2 108.2v9.4c0 1.4 1.2 2.6 2.6 2.6h211.2c1.4 0 2.6-1.2 2.6-2.6v-9.4c0-59.7-48.5-108.2-108.2-108.2z",fill:"#06275B","p-id":"1273"}}),n("path",{attrs:{d:"M604.5 611.2c-17.2 0-31.7-20.1-31.7-44s14.5-44 31.7-44c8.3 0 15-6.7 15-15s-6.7-15-15-15c-17.2 0-33.1 8.2-44.8 22.9-10.9 13.8-16.9 31.9-16.9 51s6 37.2 16.9 51c0.6 0.8 1.3 1.5 1.9 2.3-38.7 17.6-65.9 58.4-65.9 105.7 0 8.3 6.7 15 15 15s15-6.7 15-15c0-46.9 35.3-85.1 78.8-85.1 8.3 0 15-6.7 15-15s-6.7-14.8-15-14.8zM837.8 622.3c0.7-0.8 1.3-1.5 1.9-2.3 10.9-13.8 16.9-31.9 16.9-51s-6-37.2-16.9-51c-11.7-14.8-27.6-23-44.8-23-8.3 0-15 6.7-15 15s6.7 15 15 15c17.2 0 31.7 20.1 31.7 44s-14.5 44-31.7 44h-0.2c-8.3 0-15 6.7-15 15s6.7 15 15 15c43.5 0 78.8 38.2 78.8 85.1 0 8.3 6.7 15 15 15s15-6.7 15-15c0.1-47.4-27-88.1-65.7-105.8z",fill:"#06275B","p-id":"1274"}}),n("path",{attrs:{d:"M293.6 502a104.7 70.4 90 1 0 140.8 0 104.7 70.4 90 1 0-140.8 0Z",fill:"#5097FF","p-id":"1275"}}),n("path",{attrs:{d:"M365.6 633.5c-35.1 0-68-16-92.5-45-23.9-28.3-37.1-65.8-37.1-105.6s13.2-77.3 37.1-105.6c24.6-29 57.4-45 92.5-45s68 16 92.5 45c23.9 28.3 37.1 65.8 37.1 105.6s-13.2 77.3-37.1 105.6c-24.5 29-57.4 45-92.5 45z m0-271.2c-55 0-99.7 54.1-99.7 120.6s44.7 120.6 99.7 120.6 99.7-54.1 99.7-120.6-44.7-120.6-99.7-120.6z",fill:"#06275B","p-id":"1276"}}),n("path",{attrs:{d:"M565.9 932h-359c-16.5 0-30-13.5-30-30v-23.7c0-115.2 94.3-209.5 209.5-209.5s209.5 94.3 209.5 209.5V902c0 16.5-13.5 30-30 30z",fill:"#5097FF","p-id":"1277"}}),n("path",{attrs:{d:"M565.9 947H165.4c-24.8 0-45-20.2-45-45v-23.7c0-59.7 23.4-116 65.9-158.6 42.5-42.5 98.8-65.9 158.6-65.9h41.5c59.7 0 116 23.4 158.6 65.9s65.9 98.8 65.9 158.6V902c0 24.8-20.2 45-45 45z m-221-263.2c-51.7 0-100.5 20.3-137.4 57.1s-57.1 85.6-57.1 137.4V902c0 8.3 6.7 15 15 15h400.5c8.3 0 15-6.7 15-15v-23.7c0-51.7-20.3-100.5-57.1-137.4-36.9-36.9-85.6-57.1-137.4-57.1h-41.5zM494.9 392.6c-1.7 0-3.2-0.2-4.7-0.6-6.2-1.5-11.1-5.3-14-10.7-5.5-10.4-1-22.4 2.9-32.9 0.8-2.1 1.9-5 2.6-7.4-61.9-27.9-97.2-70-97.2-116.4 0-41.1 27.8-79.1 78.3-106.9C510.5 91.4 573.5 77 640.3 77c25.6 0 50.9 2.1 75.1 6.4 8.2 1.4 13.6 9.2 12.2 17.3-1.4 8.2-9.2 13.6-17.3 12.2C687.8 109 664.2 107 640.3 107c-61.8 0-119.7 13.1-163 37-40.5 22.3-62.8 50.9-62.8 80.7 0 17.1 7.3 33.8 21.7 49.5 14.8 16.2 36.7 30.7 63.4 42 3.6 1.5 15.1 7.8 12.8 24.9-0.7 5.7-2.9 11.5-4.9 17.2 6-2.4 12.9-5.3 18.3-7.7 26.9-11.5 37-15.4 45.2-14 22.3 3.8 45.6 5.8 69.3 5.8 61.8 0 119.7-13.1 163-37 40.5-22.3 62.8-50.9 62.8-80.7 0-28.8-20.8-51-38.2-64.6-1.9-1.5-3.3-2.6-4.3-3.5-2.2-1.8-2.8-2.3-6.9-4.8-7.1-4.2-9.4-13.4-5.2-20.6 4.2-7.1 13.4-9.4 20.6-5.2 5.8 3.5 7.6 4.9 10.6 7.4 1 0.8 2.1 1.7 3.7 3 32.6 25.4 49.8 55.9 49.8 88.3 0 41.1-27.8 79.1-78.3 106.9-47.7 26.3-110.7 40.7-177.5 40.7-24.8 0-49.3-2-72.8-5.9-5.2 1.1-20 7.5-29.9 11.7-23.8 10.1-34.8 14.5-42.8 14.5z",fill:"#06275B","p-id":"1278"}}),n("path",{attrs:{d:"M785.2 119.3c6.6 2.2-3.6-1.4 2.6 1.1",fill:"#FFFFFF","p-id":"1279"}}),n("path",{attrs:{d:"M787.8 135.4c-1.9 0-3.9-0.4-5.8-1.2-1.1-0.4-1.8-0.8-2.2-1-0.1 0-0.2-0.1-0.3-0.1-7.3-2.9-11.2-11.1-8.6-18.7 2.6-7.9 11.2-12.1 19-9.4 0.1 0 0.3 0.1 0.4 0.1 0.7 0.2 1.5 0.4 2.3 0.7 3.2 1.2 5.7 3.3 7.4 5.9 2.8 4.1 3.6 9.4 1.5 14.3-2.3 6-7.9 9.4-13.7 9.4z",fill:"#06275B","p-id":"1280"}}),n("path",{attrs:{d:"M475.3 222.7a174.8 91.7 0 1 0 349.6 0 174.8 91.7 0 1 0-349.6 0Z",fill:"#5097FF","p-id":"1281"}}),n("path",{attrs:{d:"M687.3 247.3c-3 0-5.9-0.9-8.6-2.7-6.8-4.7-8.5-14.1-3.7-20.9l13.4-19.2c4.7-6.8 14.1-8.5 20.9-3.7 6.8 4.7 8.5 14.1 3.7 20.9l-13.4 19.2c-2.9 4.1-7.6 6.4-12.3 6.4z",fill:"#06275B","p-id":"1282"}}),n("path",{attrs:{d:"M627.3 247.3c-3 0-5.9-0.9-8.6-2.7-6.8-4.7-8.5-14.1-3.7-20.9l13.4-19.2c4.7-6.8 14.1-8.5 20.9-3.7 6.8 4.7 8.5 14.1 3.7 20.9l-13.4 19.2c-2.9 4.1-7.6 6.4-12.3 6.4z",fill:"#06275B","p-id":"1283"}}),n("path",{attrs:{d:"M567.3 247.3c-3 0-5.9-0.9-8.6-2.7-6.8-4.7-8.5-14.1-3.7-20.9l13.4-19.2c4.7-6.8 14.1-8.5 20.9-3.7 6.8 4.7 8.5 14.1 3.7 20.9l-13.4 19.2c-2.9 4.1-7.6 6.4-12.3 6.4z",fill:"#06275B","p-id":"1284"}})])},E=[],N=(n("83b4"),{}),T=Object(u["a"])(N,D,E,!0,null,null,null);T.options.__file="Icon.vue";var q=T.exports,A=n("a3c5"),H=n.n(A),J={components:{Icon:q},name:"home",data:function(){var e=["刘一","陈二","张三","李四","王五","赵六","孙七","周八","吴九","郑十"];return{activeName:"join",room:this.$route.query.room,name:e[Math.floor(10*Math.random())]}},methods:Object(V["a"])({},Object(p["c"])({setMeName:"setMeName"}),{join:function(){""!==this.name?(this.setMeName(this.name),this.$router.push({name:"room",params:{room:this.room}})):A["Message"].error("请输入您的昵称")}}),watch:{activeName:function(e){this.room="create"===e?B()():this.$route.query.room}}},W=J,L=(n("dbc2"),Object(u["a"])(W,$,Z,!1,null,null,null));L.options.__file="Home.vue";var G=L.exports,K=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"room"},[n("div",{staticClass:"video-side"},[n("div",{staticClass:"people",attrs:{id:"people"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.state.screenSharing,expression:"state.screenSharing"}],staticClass:"person"},[n("div",{staticClass:"person__video"},[n("video",{ref:"meScreen",attrs:{autoplay:""}}),e._m(0)])]),n("div",{staticClass:"person"},[n("div",{staticClass:"person__video"},[n("video",{ref:"meVideo",attrs:{src:""}}),n("div",{staticClass:"person__name"},[n("span",{staticStyle:{color:"red"}},[e._v("(自己)")]),e._v("\n            "+e._s(e.state.name)+"\n          ")])])]),e._l(e.videoClients,function(e){return n("Video",{key:e.peer.id+e.peer.type,attrs:{client:e}})}),e._l(e.screenClients,function(e){return n("Video",{key:e.peer.id+e.peer.type,attrs:{client:e}})})],2),n("Controls")],1),n("div",{staticClass:"chat-side",style:{height:e.state.showChat?"80vh":0}},[e.chatable?n("Chat"):e._e()],1)])},Q=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"person__name"},[n("span",{staticStyle:{color:"red"}},[e._v("(自己)[屏幕共享]")])])}],U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{person:!0,person__zoom:e.isZoomed}},[n("div",{staticClass:"person__video video__reverse"},[n("div",{ref:"person"}),n("div",{staticClass:"video__control"},[n("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:e.isMuted?"解除禁音":"禁音",placement:"right-start"}},[n("el-button",{attrs:{type:e.isMuted?"primary":"danger",icon:"el-icon-headset",circle:""},on:{click:e.toggleMute}})],1),n("el-button",{attrs:{type:"success",icon:"el-icon-crop",circle:""},on:{click:e.toggleZoomed}}),n("el-button",{attrs:{type:"success",icon:"el-icon-full-screen",circle:""},on:{click:e.toggleFullScreen}})],1),n("div",{staticClass:"person__name"},["video"===e.client.peer.type?n("span",[e._v(e._s(e.client.peer.nick))]):n("span",[e._v("\n        "+e._s(e.client.peer.nick)+"\n        "),n("span",{staticStyle:{clor:"#409EFF"}},[e._v("[屏幕共享]")])])])])])},X=[],Y={props:["client"],data:function(){return{isZoomed:!1,isMuted:!1}},methods:{toggleZoomed:function(){console.log("放大全屏"),this.isZoomed=!this.isZoomed},toggleMute:function(){this.isMuted=!this.isMuted;var e=this.client.peer.stream;e.getAudioTracks()[0].enabled=!this.isMuted},toggleFullScreen:function(){var e=this.client.video,t=e.webkitDisplayingFullscreen||e.displayingFullscreen,n=e.webkitRequestFullScreen||e.requestFullScreen,o=e.webkitExitFullScreen||e.exitFullScreen;t?o.call(e):n.call(e)}},mounted:function(){this.$refs.person.append(this.client.video),this.client.video.play()},watch:{isZoomed:function(e){this.client.video.play()}}},ee=Y,te=(n("da36"),Object(u["a"])(ee,U,X,!1,null,null,null));te.options.__file="Video.vue";var ne=te.exports,oe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{person:!0,person__zoom:e.isZoomed}},[n("div",{staticClass:"person__video",on:{click:e.toggleZoomed}},[n("video",{ref:"person",attrs:{autoplay:""}})]),n("div",{staticClass:"person__name"},[n("span",[e._v(e._s(e.client.peer.nick)+"[屏幕共享]")]),n("p",[e._v(e._s(e.client.peer.stream.id))])])])},se=[],ie={props:["client"],data:function(){return{isZoomed:!1}},methods:{toggleZoomed:function(){console.log("放大全屏"),this.isZoomed=!this.isZoomed}},mounted:function(){this.$refs.person.srcObject=this.client.peer.stream},watch:{isZoomed:function(e){this.client.video.controls=e}}},ae=ie,re=Object(u["a"])(ae,oe,se,!1,null,null,null);re.options.__file="Screen.vue";var ce=re.exports,le=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{staticClass:"controls"},[e.state.muted?n("li",{staticClass:"controls__item"},[n("a",{staticClass:"controls__link",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.unmuteMe(t)}}},[e._v("开麦")])]):n("li",{staticClass:"controls__item controls__off"},[n("a",{staticClass:"controls__link",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.muteMe(t)}}},[e._v("关麦")])]),e.state.paused?n("li",{staticClass:"controls__item"},[n("a",{staticClass:"controls__link",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.unpauseMe(t)}}},[e._v("打开视频")])]):n("li",{staticClass:"controls__item controls__off"},[n("a",{staticClass:"controls__link",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.pauseMe(t)}}},[e._v("关闭视频")])]),e.state.screenSharing?n("li",{staticClass:"controls__item controls__off"},[n("a",{staticClass:"controls__link disabled",attrs:{href:""},on:{click:function(e){e.preventDefault()}}},[e._v("屏幕共享")])]):n("li",{staticClass:"controls__item"},[n("a",{staticClass:"controls__link",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.shareScreen(t)}}},[e._v("屏幕共享")])]),e.state.showChat?n("li",{staticClass:"controls__item controls__off"},[n("a",{staticClass:"controls__link",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.closeChat(t)}}},[e._v("收起聊天")])]):n("li",{staticClass:"controls__item"},[n("a",{staticClass:"controls__link",attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.openChat(t)}}},[e._v("打开聊天")])])])},ue=[],de={methods:Object(V["a"])({},Object(p["c"])({setMuted:"setMuted",setPaused:"setPaused",setScreenSharing:"setScreenSharing",setShowChat:"setShowChat"}),{muteMe:function(){window.webrtc.mute(),this.setMuted(!0)},unmuteMe:function(){window.webrtc.unmute(),this.setMuted(!1)},pauseMe:function(){window.webrtc.pauseVideo(),this.setPaused(!0)},unpauseMe:function(){window.webrtc.resumeVideo(),this.setPaused(!1)},shareScreen:function(){var e=this;window.webrtc.shareScreen(function(t){t&&0===t.code?(console.log("拒绝了摄像头授权"),window.webrtc.stopScreenShare(),e.setScreenSharing(!1)):(console.log("分享屏幕",{event:t}),e.setScreenSharing(!0))})},stopScreenShare:function(){},closeChat:function(){this.setShowChat(!1)},openChat:function(){this.setShowChat(!0)}}),computed:Object(V["a"])({},Object(p["b"])({state:"getState"}))},fe=de,pe=(n("3bd3"),Object(u["a"])(fe,le,ue,!1,null,null,null));pe.options.__file="Controls.vue";var me=pe.exports,ve=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chat"},[n("h1",{staticStyle:{"text-align":"center"}},[e._v("文字聊天")]),n("div",{ref:"chatContent",staticClass:"chat-content"},e._l(e.messages,function(t,o){return n("p",{key:o+t},[n("span",{staticStyle:{"font-weight":"bold"}},[e._v(e._s(t.nick))]),e._v(":\n      "),n("em",[e._v(e._s(t.content))])])})),n("div",{staticClass:"chat-operation"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.messageContent,expression:"messageContent"}],attrs:{type:"text"},domProps:{value:e.messageContent},on:{input:function(t){t.target.composing||(e.messageContent=t.target.value)}}}),n("button",{on:{click:e.sendMessage}},[e._v("发送消息")])])])},he=[],_e={data:function(){return{messageContent:""}},computed:Object(V["a"])({},Object(p["b"])({messages:"getMessages",state:"getState",connIsReady:"getConnIsReady",nick:"getName"})),methods:Object(V["a"])({},Object(p["c"])({addMessage:"addMessage"}),{sendMessage:function(){var e=this;if(""!==e.messageContent){if(e.connIsReady){var t={nick:e.nick,content:e.messageContent};window.webrtc.sendToAll("chat",t),e.addMessage(t),e.contetnSrollBottom()}else console.log("未连接到服务器！ ");e.messageContent=""}else console.log("请输入消息！")},receiveMessage:function(e){this.addMessage(e)},contetnSrollBottom:function(){var e=this.$refs.chatContent;e.scrollTop=e.scrollHeight}}),mounted:function(){var e=this,t=this,n=function(n){var o=n.type,s=n.payload;-1===["candidate","answer","endOfCandidates"].indexOf(o)&&console.log("收到消息",{type:o,payload:s}),t.contetnSrollBottom(),"chat"===o&&e.receiveMessage(s)};this.$nextTick(function(){return window.webrtc.connection.on("message",n)})}},ge=_e,be=(n("1581"),Object(u["a"])(ge,ve,he,!1,null,"38df64cc",null));be.options.__file="Chat.vue";var we=be.exports,Ce=n("e377"),ye=n.n(Ce),Se=function(){return new Promise(function(e,t){navigator.mediaDevices.enumerateDevices().then(function(n){if(n.length){var o=n.filter(function(e){return"audioinput"===e.kind}).length>0,s=n.filter(function(e){return"videoinput"===e.kind}).length>0;console.log(n),e({audio:o,video:s})}else t("zero device was found")}).catch(function(e){return t(e)})})},Me={components:{Video:ne,Screen:ce,Controls:me,Chat:we},props:{room:String},data:function(){return{chatable:!1}},computed:Object(V["a"])({},Object(p["b"])({state:"getState",videoClients:"getVideoClients",screenClients:"getScreenClients"})),methods:Object(V["a"])({},Object(p["c"])({addPeer:"addPeer",removePeer:"removePeer",setConnIsReady:"setConnIsReady",setScreenSharing:"setScreenSharing"}),{initMedia:function(e){var t=this;window.webrtc=new ye.a({localVideoEl:"",remoteVideosEl:"",autoRequestMedia:!1,nick:this.state.name,url:"https://mohan.z-os.cn",peerConnectionConfig:{iceServers:[{url:"stun:116.63.153.127"},{url:"turn:116.63.153.127",secret:"xwj",username:"xwj",credential:"xwj"}]},media:e,debug:!1}),window.webrtc.startLocalVideo(),window.webrtc.on("readyToCall",function(){console.log("加入房间",t.room),window.webrtc.joinRoom(t.room),t.setConnIsReady(!0),t.chatable=!0}),window.webrtc.on("videoAdded",function(e,n){console.log("加入事件",n.stream.id),t.addPeer({video:e,peer:n})}),window.webrtc.on("videoRemoved",function(e,n){n&&t.removePeer(n)}),window.webrtc.on("localScreen",function(e){console.log("本地视频added",e),t.$refs.meScreen.srcObject=e}),window.webrtc.on("localScreenStopped",function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];console.log("本地视频停止了",{args:n}),window.webrtc.stopScreenShare(),t.setScreenSharing(!1)}),window.webrtc.on("localStream",function(e){console.log("添加本地流");var o=n("c73d");o(e,t.$refs.meVideo,{autoplay:!0,mirror:!0,muted:!0})})}}),mounted:function(){var e=this;Se().then(function(t){var n,o=t.video,s=t.audio;o&&s?(console.log("摄像头、麦克风都有"),n={video:{frameRate:{ideal:10,max:15}},audio:!0}):s?(console.log("只有麦克风"),n={video:!1,audio:!0}):o?(console.log("只有摄像头"),n={video:{frameRate:{ideal:10,max:15}},audio:!1}):(console.log("摄像头、麦克风都无"),n={video:!1,audio:!0}),console.log({media:n}),e.initMedia(n)})}},ke=Me,je=(n("be3b"),Object(u["a"])(ke,K,Q,!1,null,null,null));je.options.__file="Index.vue";var xe=je.exports;i["a"].use(R["a"]);var Oe=new R["a"]({mode:"history",routes:[{path:"/",name:"home",component:G},{path:"/room/:room",name:"room",component:xe,props:!0,beforeEnter:function(e,t,n){P.getters.getState.name||n({name:"home",query:{room:e.params.room}}),n()}}]});n("b9b6");i["a"].config.productionTip=!1,i["a"].use(H.a),new i["a"]({router:Oe,store:P,render:function(e){return e(f)}}).$mount("#app")},"5c0b":function(e,t,n){"use strict";var o=n("5e27"),s=n.n(o);s.a},"5e27":function(e,t,n){},"68c4":function(e,t,n){},7024:function(e,t,n){},"7a0a":function(e,t,n){},"83b4":function(e,t,n){"use strict";var o=n("ba5a"),s=n.n(o);s.a},ba5a:function(e,t,n){},be3b:function(e,t,n){"use strict";var o=n("68c4"),s=n.n(o);s.a},c518:function(e,t,n){},da36:function(e,t,n){"use strict";var o=n("c518"),s=n.n(o);s.a},dbc2:function(e,t,n){"use strict";var o=n("ea59"),s=n.n(o);s.a},ea59:function(e,t,n){}});